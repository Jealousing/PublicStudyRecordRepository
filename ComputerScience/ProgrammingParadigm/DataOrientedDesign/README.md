# Data Oriented Design (DOD)   

## 데이터 지향 설계란?  
 데이터 지향 설계(Data Oriented Design, DOD)는 프로그램을 개발할 때 데이터의 구조와 접근 방식을 중심으로 설계하는 개발 방법론입니다.     
이는 프로그램의 성능 향상과 메모리 사용 최적화를 목표로 하며, 특히 대규모 데이터를 다루는 시스템에서 효과적입니다.


## DOD의 주요 특징
* 데이터 중심: 프로그램의 동작을 데이터의 관점에서 바라보고, 데이터의 구조와 접근 패턴을 중심으로 설계합니다.   
* 성능 향상: 데이터 접근 패턴을 최적화하여 프로세서 캐시 활용을 극대화하고, 메모리 관리를 효율적으로 합니다.   
* 메모리 지향적: 데이터의 연속성을 유지하여 메모리 접근을 최적화하고, 메모리 관리를 효율적으로 합니다.   
* 캐시 미스 최소화: 데이터를 연속적으로 배치하여 캐시 효율성을 높여 캐시 미스를 최소화합니다. 이는 프로세서가 데이터를 더 빠르게 로드할 수 있어 성능 향상에 기여합니다.   

```
캐시 미스(cache miss)는 CPU가 메모리에서 데이터를 요청했지만 캐시에 해당 데이터가 없어서 발생하는 현상입니다. 
캐시 미스는 CPU가 데이터를 메인 메모리에서 가져오는 데 필요한 시간을 소비하므로 성능에 부정적인 영향을 미칩니다.

데이터 지향 설계(DOD)에서는 캐시 미스를 최소화하기 위해 데이터를 연속적으로 배치하여 메모리 접근 패턴을 최적화합니다.
```

## 핵심 개념    
* 연속성(Contiguity): 데이터를 연속된 메모리 공간에 배치하여 메모리 접근 패턴을 최적화합니다.   
메모리의 연속성은 캐시(Cache) 효율성을 높여 성능을 향상시키는 데 중요합니다. 연속된 메모리 공간에 배치된 데이터는 프로세서가 캐시 라인(cache line)에 더 쉽게 로드할 수 있어 메모리 접근 속도가 향상됩니다. 이는 데이터의 접근 패턴이 예측 가능하고 캐시 미스(cache miss)를 최소화함으로써 성능을 향상시킬 수 있습니다.   
* 분리(Separation): 데이터와 해당 데이터를 처리하는 코드를 분리하여 응집도를 높이고 유지보수성을 향상시킵니다.  
데이터와 해당 데이터를 처리하는 코드를 분리함으로써 데이터 구조와 데이터 처리 로직을 독립적으로 유지할 수 있습니다. 이는 코드의 가독성과 유지보수성을 향상시키며, 코드의 재사용성을 높입니다. 또한, 분리된 데이터를 병렬 처리하는 것이 더욱 용이해지므로 성능적인 측면에서도 중요합니다.    
* 병렬 처리(Parallelism): 병렬 처리는 데이터 구조를 병렬 처리하기 쉽도록 설계하여 멀티스레드 및 SIMD(Single Instruction, Multiple Data) 등을 활용하여 성능을 극대화하는 개념입니다.    
대규모 데이터를 다루는 시스템에서는 데이터 처리 속도를 높이기 위해 병렬 처리가 필수적입니다. 데이터 지향 설계는 데이터의 분리와 연속 배치를 통해 병렬 처리를 촉진함으로써 성능을 극대화할 수 있습니다.


### 장점
* 성능 향상: DOD는 데이터의 구조와 접근 패턴을 최적화하여 성능을 향상시킵니다. 특히 데이터를 연속적으로 배치하여 메모리 접근을 최적화하는 데 큰 도움이 됩니다.   
* 확장성: 대규모 데이터를 처리하는 시스템에서 DOD를 적용하면 확장성을 높일 수 있습니다. 데이터 중심 설계는 데이터의 추가나 변경에 유연하게 대응할 수 있습니다.   
* 병렬 처리 용이성: 데이터의 분리와 연속 배치로 인해 병렬 처리가 용이해집니다. 멀티코어 프로세서와 같은 병렬 처리 장치를 활용하여 성능을 향상시킬 수 있습니다.   
* 코드 재사용성 향상: 데이터 중심 설계는 코드를 모듈화하고 재사용하기 쉽게 만듭니다. 비슷한 데이터 구조를 가진 모듈은 쉽게 재사용할 수 있습니다   

### 단점
* 구현 복잡성: DOD를 적용하는 것은 기존의 객체 지향적인 설계에 비해 구현이 복잡할 수 있습니다. 데이터의 구조와 접근 패턴을 고려하여 설계하기 때문에 초기에는 어려움을 겪을 수 있습니다.   
* 추상화 부족: 객체 지향 프로그래밍(OOP)에서는 추상화를 통해 문제를 모델링하고 객체 간의 관계를 나타냅니다. 반면 DOD는 성능 최적화를 목표로 하기 때문에 추상화 수준이 낮을 수 있습니다.   
* 디버깅의 어려움: 데이터 중심 설계는 추상화 수준이 낮아 디버깅이 복잡할 수 있습니다. 특히 병렬 처리와 관련된 오류를 찾기 어려울 수 있습니다.   

## DOD의 메모리 관리 및 최적화
DOD는 메모리 관리와 최적화를 통해 프로그램의 성능을 향상시키는 데 주력합니다. 이를 위해 다음과 같은 방법을 사용합니다    

### 1. 데이터의 연속성 유지
 DOD에서는 데이터를 연속된 메모리 공간에 배치하여 메모리 접근 패턴을 최적화합니다. 이렇게 하면 메모리 캐시의 효율성을 높이고 성능을 향상시킬 수 있습니다.    
연속된 메모리 공간에 배치된 데이터는 캐시 라인에 더 쉽게 로드되므로 메모리 접근 속도가 향상됩니다. 또한, 데이터의 접근 패턴이 예측 가능하고 캐시 미스를 최소화하여 성능을 높일 수 있습니다.   

### 2. 데이터 정렬
 DOD에서는 데이터를 메모리에 저장할 때 정렬하여 사용합니다. 이렇게 하면 데이터의 연속성을 유지하고 메모리 접근을 최적화할 수 있습니다.    
예를 들어, 구조체의 멤버를 크기에 따라 정렬하면 패딩을 최소화하고 메모리 공간을 절약할 수 있습니다.   

### 3. 메모리 풀 사용
 DOD에서는 메모리 풀(memory pool)을 사용하여 메모리 할당 및 해제를 최적화합니다. 메모리 풀은 프로그램 시작 시 미리 메모리를 할당하고 재사용하여 메모리 할당 및 해제의 오버헤드를 줄입니다.    
이는 프로그램의 성능을 향상시키고 메모리 단편화를 방지하는 데 도움이 됩니다.

### 4. 효율적인 자료구조 사용 
DOD에서는 효율적인 자료구조를 사용하여 메모리 사용을 최적화합니다.   
예를 들어, 배열이나 벡터와 같은 선형 자료구조를 사용하여 데이터를 연속적으로 저장하고 접근합니다. 이는 메모리 접근 패턴을 최적화하고 성능을 향상시킵니다.    

### 5. 메모리 접근 패턴 최적화 
DOD에서는 메모리 접근 패턴을 최적화하여 성능을 향상시킵니다.   
예를 들어, 데이터를 순차적으로 접근하거나 캐시 블록 크기에 맞게 데이터를 배치함으로써 메모리 접근을 최적화할 수 있습니다.   

## OOP와 DOD의 차이

* 객체 중심 vs 데이터 중심: 객체 지향 프로그래밍(OOP)은 객체의 행동과 상태를 중심으로 설계되어 객체 간의 상호작용을 강조합니다.      
반면, 데이터 지향 설계(DOD)는 데이터의 구조와 접근 패턴을 중심으로 설계되어 데이터의 처리에 초점을 맞춥니다.    
* 추상화 vs 최적화: OOP는 추상화를 통해 문제를 모델링하고, 객체 간의 관계를 나타냅니다.    
반면 DOD는 성능 최적화를 목표로 하여 메모리 접근 패턴을 최적화하고, 데이터를 연속적으로 배치하여 성능을 향상시킵니다.    

### OOP와 DOD의 코드차이
 아래는 OOP와 DOD 접근 방식을 보여주는 간단한 코드 예시입니다.   

* 객체 지향 프로그래밍 (OOP)
```cs
public class Character {
    private String name;
    private int health;

    public Character(String name, int health) {
        this.name = name;
        this.health = health;
    }

    public void takeDamage(int damage) {
        health -= damage;
        if (health <= 0) {
            die();
        }
    }

    private void die() {
        System.out.println(name + " has died.");
    }
}
```

* 데이터 지향 설계 (DOD)
```cs
public class CharacterManager {
    private List<CharacterData> characters;

    public CharacterManager() {
        characters = new ArrayList<>();
    }

    public void takeDamage(int characterIndex, int damage) {
        characters.get(characterIndex).health -= damage;
        if (characters.get(characterIndex).health <= 0) {
            die(characterIndex);
        }
    }

    private void die(int characterIndex) {
        System.out.println(characters.get(characterIndex).name + " has died.");
        characters.remove(characterIndex);
    }

    private static class CharacterData {
        public String name;
        public int health;

        public CharacterData(String name, int health) {
            this.name = name;
            this.health = health;
        }
    }
}
```

## DOD가 중요해지는 이유
* CPU와 RAM 사이의 성능 격차 증가: 현대 컴퓨터 아키텍처에서는 CPU의 성능 향상 속도가 RAM의 성능 향상 속도보다 빠르게 진행되고 있습니다. 이로 인해 CPU는 데이터를 처리하는 속도가 빠르지만, RAM에서 데이터를 가져오는 데 걸리는 시간은 상대적으로 더 길어지고 있습니다.    
이러한 성능 격차로 인해 데이터 지향 설계는 RAM의 성능 향상을 최대한 활용하기 위해 데이터의 구조와 접근 패턴을 최적화하여 CPU가 데이터를 효율적으로 활용할 수 있도록 합니다.   
* 대규모 데이터 처리의 증가: 현대의 소프트웨어 시스템은 많은 양의 데이터를 다루는 경우가 많습니다. 대용량 데이터를 효율적으로 처리하기 위해서는 데이터의 구조와 접근 방식을 최적화해야 합니다.      
데이터 지향 설계는 데이터를 연속적으로 배치하여 메모리 접근을 최적화하고, 병렬 처리를 용이하게 하여 대규모 데이터 처리를 효율적으로 수행할 수 있도록 돕습니다.   
* 성능과 확장성의 필요성 증대: 현대 소프트웨어 시스템은 더 높은 성능과 확장성을 요구합니다. 데이터 지향 설계는 성능을 향상시키고 확장성을 높이는 데 도움이 됩니다.     
데이터 중심적인 설계는 성능을 최적화하고 대규모 데이터 처리를 위한 확장성을 제공함으로써 현대 소프트웨어 시스템의 요구를 충족하는 데 기여합니다.   


## Unity 게임 개발에서의 활용
 Unity 게임 개발에서 데이터 지향 설계는 주로 성능 최적화와 메모리 관리를 위해 활용됩니다.    
특히 대규모 게임에서는 ECS(Entity Component System)와 함께 사용하여 성능을 극대화할 수 있습니다.   

## ECS와 DOD의 관계
 ECS는 데이터 지향 설계(DOD)를 기반으로 한 아키텍처로, 엔티티, 컴포넌트, 시스템으로 구성됩니다.    
데이터 지향 설계의 원칙을 따르면서 엔티티가 데이터를 담고, 시스템이 이 데이터를 처리하는 방식으로 동작합니다. ECS는 데이터 지향 설계를 구현하기 위한 하나의 방법론으로 볼 수 있습니다.

## 느낀점
데이터 지향 설계는 성능 최적화와 메모리 관리에 있어 매우 유용한 접근 방식임을 알 수 있습니다.    
특히 대규모 데이터를 다루는 시스템에서는 이를 적극적으로 활용하여 효율적인 프로그램을 개발해야 될 것 같습니다.