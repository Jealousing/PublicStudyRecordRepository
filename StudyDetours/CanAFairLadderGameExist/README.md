# 공정한 사다리 게임이 만들어질 수 있을까?
   
> 이 문서는 **"공부하다 딴길로 새버린 궁금증"** 시리즈의 일부입니다.  
> 이 시리즈는 정답을 빠르게 찾기보다는,  
> 공부 도중 생긴 의문을 따라가다 어디까지 생각이 흘러가는지를 기록합니다.
>
> 결론보다 질문이 길어지고,  
> 계산보다 판단이 중요해지는 순간들이 종종 남게 됩니다.

---

## 목차

- [0. 한 줄 요약](#0-한-줄-요약)
- [1. 이 문서를 쓰게 된 이유](#1-이-문서를-쓰게-된-이유)
- [2. 사다리 게임의 본질적 해석](#2-사다리-게임의-본질적-해석)
- [3. N~M 가로선이라는 설계 개념](#3-nm-가로선이라는-설계-개념) 
- [4. "가로선을 가리면 공정하다"는 주장에 대하여](#4-가로선을-가리면-공정하다는-주장에-대하여)
- [5. M 추정을 위한 근사 규칙](#5-m-추정을-위한-근사-규칙) 
- [6. A의 크기에 따른 실용적 판단 기준](#6-a의-크기에-따른-실용적-판단-기준)
- [7. A=3을 통한 간단한 검증 예시](#7-a3을-통한-간단한-검증-예시) 
- [8. 이론적 관점과 실용적 관점의 차이](#8-이론적-관점과-실용적-관점의-차이)
- [9. 근사식이 깨지는 극단 사례](#9-근사식이-깨지는-극단-사례)
- [10. 참고용 C++ 시뮬레이션 코드](#10-참고용-c-시뮬레이션-코드)
- [11. 결국 사다리는 무엇인가](#11-결국-사다리는-무엇인가)
- [12. 사다리 게임 구현 체크리스트](#12-사다리-게임-구현-체크리스트) 
- [이 문서의 결론](#이-문서의-결론)
- [부록: 빠른 참조표](#부록-빠른-참조표) 
  
---

## 0. 한 줄 요약

사다리 게임은 정말 공정할까?  
이 문서는 경우의 수와 공식을 찾으려다, 결국 **확률 수렴과 설계 판단의 문제**라는 결론에 이르기까지의 사고 기록이다.

---

## 1. 이 문서를 쓰게 된 이유

사다리 게임은 직관적으로 매우 "공정해 보이는" 구조를 가지고 있다.
출발지가 A개이고 도착지가 A개일 때, 우리는 자연스럽게 다음을 기대한다.

> 각 출발지는 모든 도착지에 대해 동일한 확률(1/A)을 가진다.

하지만 실제로 사다리 게임을 구현하려고 하면 곧 다음과 같은 질문에 부딪힌다.

- 가로선은 **몇 개**가 필요할까?
- 너무 적으면 편향되지 않을까?
- 너무 많으면 성능이나 연출 문제가 생기지 않을까?
- 가로선을 가리면 정말 공정해지는 걸까?

처음에는 이 문제를 **경우의 수 계산 문제**라고 생각했다.
하지만 파고들수록 이 문제는 공식을 찾는 문제가 아니라,

> "이 결과를 공정하다고 말해도 되는가"

를 판단하는 문제라는 쪽으로 성격이 바뀌었다.

이 문서는 그 사고의 전환 과정을 정리한 기록이다.

---

## 2. 사다리 게임의 본질적 해석

사다리 게임에서 가로선 하나는 인접한 두 위치를 교환(swap)하는 연산이다.
여러 개의 가로선은 다음 과정을 의미한다.

1. 하나의 시작점이
2. 여러 번의 인접 교환을 거쳐서
3. 하나의 도착점에 도달한다.

이는 결국 **순열 공간 위에서의 확률적 이동**이며, <br>
사다리 게임은 조합론보다는 **마르코프 체인(Markov Chain)** 과 **mixing(충분한 섞임)** 문제에 가깝다.

> ※ **마르코프 체인**: 다음 상태가 오직 현재 상태에만 의존하는 확률 과정<br>
>    (사다리에서는 "지금 어느 세로선에 있는가"만 중요)
> 
> ※ **mixing**: 충분히 반복하면 어디서 시작했든 비슷한 결과 분포를 보이는 성질<br>
>    (가로선을 충분히 지나면 출발점의 영향이 사라지고 모든 도착지가 같은 확률을 갖게 되는 현상)

이 관점에서 보면:

- 정확한 경우의 수를 세는 닫힌 공식은 존재하지 않고
- 중요한 것은 "충분히 섞였는가"이다.

---

## 3. N~M 가로선이라는 설계 개념

사다리 게임에서 우리가 기대하는 공정성이란,
각 출발지가 모든 도착지에 대해 동일한 확률(1/A)을 가지는 상태다.

### 공정성의 정량적 기준

이 문서에서 "충분히 공정하다"는 다음을 의미한다:

```
각 (출발지 → 도착지) 확률이 이론값 1/A ± 0.02 범위 내
```

예를 들어 A=5일 때:
- 이론값: 0.200
- 허용 범위: 0.180 ~ 0.220
- 즉, 각 확률이 18% ~ 22% 사이면 "충분히 공정"

이 ±0.02는 실용적 판단 기준으로, 더 엄격한 기준(±0.01)이나 더 느슨한 기준(±0.03)도 사용 가능하다.

### 가로선 개수의 영향

가로선의 개수가 매우 적을 경우, 이 확률 분포는 구조적으로 크게 왜곡된다. <br>
특정 출발지는 특정 도착지로 더 자주 도달하게 되고,
일부 경우는 거의 발생하지 않는다.

가로선의 개수가 늘어날수록,
인접교환의 반복으로 인해
출발지와 도착지 사이의 확률 분포는 점차 1/A에 가까워진다.

### N~M 구조의 필요성

여기서 등장하는 N~M은 정확한 수학적 경계가 아니라,
이 확률 분포를 설계 관점에서 다루기 위한 표현이다.

- **N (최소 가로선 수)**: 
  - 확률 분포가 1/A ± 0.02 범위에 처음 진입하는 지점
  - 이보다 적으면 구조적 편향이 명확히 관찰됨
  - 예: A=5일 때 N ≈ 15~20

- **M (최대 가로선 수)**:
  - 이 이상 늘려도 확률 분포 개선이 미미한 지점
  - 성능·연출·가독성을 고려한 상한
  - 예: A=5일 때 M ≈ 60~80

이때 가로선 개수를 고정하면 다음 문제가 발생한다:

- 가능한 순열의 일부만 생성됨
- 특정 결과가 구조적으로 더 자주 등장함

이를 피하기 위해 실용적으로 등장하는 개념이 **N~M 가로선 구조**다.

실제 가로선 수는 N~M 사이에서 랜덤 선택함으로써:
- 고정 개수로 인한 구조적 편향을 제거하고
- 매번 다른 mixing 패턴을 만들어낸다

이 구조는:
- 사다리를 **보여줄 때도 필요하고**
- 사다리를 **가릴 때는 오히려 더 중요해진다**.

---

## 4. "가로선을 가리면 공정하다"는 주장에 대하여

사다리 게임에서 흔히 들을 수 있는 말은 다음과 같다.

> "가로선을 안 보이게 하면 공정하다"

하지만 이것은 **수학적 공정성**이 아니라 **인지적 공정성**에 가깝다.

- 플레이어는 내부 구조를 볼 수 없고
- 결과 조작을 의심하기 어려워진다.

>그러나 이는 공정함을 만드는 방법이 아니라, 공정함을 검증할 수 없게 만드는 연출일 뿐이다.

가려진 사다리에서도
- 가로선 위치는 랜덤이어야 하며
- 가로선 개수 역시 반드시 N~M 범위에서 랜덤이어야 한다.

숨겼다고 해서 편향이 사라지는 것은 아니다.

---

## 5. M 추정을 위한 근사 규칙

> ⚠️ 주의: 이 섹션에서 등장하는 근사식은 **증명된 공식이 아니다**.  
> 계산을 대체하기 위한 수학이 아니라, 결정을 돕기 위한 규칙이다.

여기서 말하는 근사식은, 각 출발지가 각 도착지에 도달할 확률이 <br>
모든 경우에서 1/A ± 0.02 범위에 안정적으로 들어갈 만큼 <br>
가로선을 얼마나 많이 허용해야 하는지를 추정하기 위한 것이다.

인접교환만 허용되는 사다리 구조에서는 경험적으로 다음과 같은 경향이 관찰된다.

```
권장 최대 가로선 수 M ≈ k · A³
```

### k 값 선택 가이드

k는 설계 우선순위에 따라 선택한다:

| k 값 | 사용 시나리오 | 특징 |
|------|-------------|------|
| 0.5 | 빠른 계산 우선 | 최소한의 mixing만 보장, 가벼운 게임용 |
| 1.0 | 기본값  | 대부분의 경우 권장 |
| 1.5 | 조금 엄격한 환경 | 확률 편차를 더 줄이고 싶을 때 |
| 2.0 | 매우 엄격한 환경 | 금전적 보상이 있거나 법적 검토가 필요한 경우 |

**권장값: k = 1.0**

예시 계산:
- A=3: M ≈ 1.0 × 27 = 27
- A=5: M ≈ 1.0 × 125 = 125  
- A=7: M ≈ 1.0 × 343 = 343

### N 값 추정

N(최소 가로선 수)은 일반적으로 다음과 같이 추정할 수 있다:

```
N ≈ 0.3 × M ≈ 0.3k · A³
```

k=1.0일 때:
- A=3: N ≈ 8~10
- A=5: N ≈ 35~40
- A=7: N ≈ 100~110

이 근사식은:
- 정확한 계산 없이도 설계 판단을 가능하게 하고
- A가 작은 경우 매우 안정적으로 작동한다.

단, 이는 수학적으로 증명된 공식이 아니라,
확률 분포가 충분히 1/A에 가까워졌다고
판단하기 위한 경험적 기준에 가깝다.

**조건부 근사식**이며 다음 경우에는 깨진다:

- A가 매우 작은 경우 (A ≤ 3, 과대 추정되지만 무해)
- 교환 선택 확률이 균등하지 않은 경우
- 인접교환이 아닌 구조를 허용한 경우
- A가 커져 사다리 자체가 연출로서 의미를 잃는 경우

즉, 이 규칙은
**작은 A에서 사다리 연출을 유지하고 싶은 경우**에 한해 유효하다.

---

## 6. A의 크기에 따른 실용적 판단 기준

| A 범위 | N 예시 | M 예시 (k=1.0) | 판단 |
|--------|--------|----------------|------|
| 2~3 | 5~10 | 15~30 | 즉시 균등, 근사식 불필요 |
| 4~6 | 20~65 | 65~216 | A³ 근사식 매우 적합 |
| 7~8 | 100~150 | 343~512 | 성능·연출 검토 필요 |
| 9~10 | 220~300 | 729~1000 | 사다리 방식 경계선 |
| ≥10 | - | - | 사다리로 공정성 보장 불가 |

이 표는 수학적 증명이 아니라,
**설계 결정을 돕기 위한 경험적 기준**이다.

---

## 7. A=3을 통한 간단한 검증 예시

이 문서의 논의가 지나치게 추상적으로 느껴질 수 있기 때문에, 가장 작은 의미 있는 사례인 **A=3**을 통해 직관적 검증을 덧붙인다.

- 출발지: 3개
- 도착지: 3개
- 가능한 순열: 3! = 6

A=3 사다리에서 가로선 하나는 다음 중 하나의 인접 교환이다.

- (1,2) 교환
- (2,3) 교환

### 실제 시뮬레이션 결과

100만 회 시뮬레이션 결과 (각 출발지 → 각 도착지 확률):

**가로선 2개 사용 시 (충분하지 않음):**
```
출발 0: [0.502, 0.249, 0.249]  ← 0번 출발지가 0번 도착에 편향
출발 1: [0.250, 0.500, 0.250]  ← 1번 출발지가 1번 도착에 편향
출발 2: [0.248, 0.251, 0.501]  ← 2번 출발지가 2번 도착에 편향

→ 이론값 0.333에서 크게 벗어남 (최대 편차 ±0.17)
```

**가로선 5개 사용 시 (최소 mixing):**
```
출발 0: [0.351, 0.324, 0.325]
출발 1: [0.325, 0.350, 0.325]
출발 2: [0.324, 0.326, 0.350]

→ 이론값 0.333에 근접 (최대 편차 ±0.02)
```

**가로선 20개 사용 시 (충분한 mixing):**
```
출발 0: [0.334, 0.333, 0.333]
출발 1: [0.333, 0.334, 0.333]
출발 2: [0.333, 0.333, 0.334]

→ 거의 완벽한 균등 분포 (최대 편차 ±0.001)
```

이 사례는 중요한 사실을 보여준다.

> 사다리의 공정성은 "구조"가 아니라 "충분한 섞임"에서 나온다.

---

## 8. 이론적 관점과 실용적 관점의 차이

### 이론적 관점

- 목표: 무한히 많은 가로선이 있을 때의 극한 분포
- 결과: 정상 분포는 균등 (1/A)
- 관심사: 수렴 여부 자체

### 실용적 관점

- 목표: 유한한 가로선으로 "충분히 공정하다"고 말할 수 있는가
- 결과: 완전 균등이 아닌 "허용 오차 내 균등" (1/A ± 0.02)
- 관심사: 성능, 연출, 가독성, 신뢰성

이 차이 때문에:
- 이론적으로는 "언젠가는" 공정하지만
- 실용적으로는 N~M 같은 설계 기준이 필요하다.

---

## 9. 근사식이 깨지는 극단 사례

이 근사 규칙은 다음과 같은 상황에서는 신뢰할 수 없다.

1. **A가 매우 작은 경우 (A ≤ 3)**  
   → 과도한 가로선 수를 제안하지만, 실질적으로는 무해

2. **교환 선택 확률이 균등하지 않은 경우**  
   → 정상 분포 자체가 균등이 아님

3. **인접교환이 아닌 구조를 허용한 경우**  
   → 필요한 mixing 규모가 완전히 달라짐

4. **A가 큰 경우 (A ≥ 9~10)**  
   → 사다리 구조 자체가 공정성 구현 도구로 부적합

이러한 경우에는 사다리를 공정성 도구로 사용하는 발상을 재검토해야 한다.

---

## 10. 참고용 C++ 시뮬레이션 코드

아래 코드는 사다리 게임을 단순화한 모델로, 가로선 개수 증가에 따라 각 출발지가 도착지로 이동하는 확률이 어떻게 수렴하는지 관찰하기 위한 것이다.

```cpp
#include <iostream>
#include <vector>
#include <random>
using namespace std;

int main() 
{
    int A = 3;              // 출발지/도착지 수
    int trials = 1000000;   // 시뮬레이션 반복 횟수
    int ladders = 20;       // 가로선 개수
    
    // count[i][j] = 출발지 i에서 도착지 j로 도달한 횟수
    vector<vector<int>> count(A, vector<int>(A, 0));
    
    // 난수 생성기 초기화
    random_device rd;
    mt19937 gen(rd());
    uniform_int_distribution<> dist(0, A - 2);  // 0부터 A-2까지 랜덤

    // 시뮬레이션 실행
    for (int t = 0; t < trials; ++t) 
    {
        // 초기 위치: 각 세로선에 자기 번호 배치
        vector<int> pos(A);
        for (int i = 0; i < A; ++i) pos[i] = i;

        // ladders개의 가로선 적용 (인접 swap)
        for (int l = 0; l < ladders; ++l) 
        {
            int i = dist(gen);  // 랜덤하게 인접한 두 세로선 선택
            swap(pos[i], pos[i + 1]);  // 교환
        }

        // 결과 기록: 출발지 i가 어느 도착지로 갔는지
        for (int i = 0; i < A; ++i)
            count[i][pos[i]]++;
    }

    // 결과 출력: 각 출발지별 도착 확률 분포
    cout << "출발지 → 도착지 확률 분포:" << endl;
    for (int i = 0; i < A; ++i) 
    {
        cout << "출발 " << i << ": [";
        for (int j = 0; j < A; ++j) {
            cout << (double)count[i][j] / trials;
            if (j < A-1) cout << ", ";
        }
        cout << "]" << endl;
    }
    
    cout << "\n이론값: 각 확률이 " << 1.0/A << "에 가까워야 공정함" << endl;
}
```

이 코드는:
- 정확한 답을 구하기 위한 것이 아니라
- "충분히 섞이면 균등해진다"는 직관을 확인하기 위한 도구다.
  
**파라미터 조정:**
- `ladders` 값을 2, 5, 10, 20으로 바꿔가며 실행하면 수렴 과정을 관찰할 수 있다
- `A` 값을 4, 5, 6으로 바꿔가며 A 증가에 따른 필요 가로선 수 변화를 확인할 수 있다

---

## 11. 결국 사다리는 무엇인가

이 고민의 끝에서 도달한 결론은 다음과 같다.

- A가 작을 때 (A ≤ 8):
  - 사다리는 공정성을 구현하는 도구가 될 수 있다.
  - N~M 랜덤 가로선 구조로 충분히 균등 분포를 만들 수 있다.
  
- A가 커질수록 (A ≥ 9):
  - 사다리는 공정성을 구현하는 도구가 아니라
  - 공정함을 *보여주기 위한 연출*이 된다.
  - 필요한 가로선 수가 너무 많아져 실용성이 떨어진다.

실제 많은 게임에서는:
- 내부적으로는 균등 순열을 생성하고 (Fisher-Yates shuffle 등)
- 외부적으로는 사다리 연출만 재생한다.

---
  
## 이 문서의 결론

이 문서는:

- 공정한 사다리 게임의 공식을 제시하지 않는다.
- 대신 왜 공식이 없으며, 그럼에도 불구하고 어떻게 판단해야 하는지를 정리한다.

즉, 이 기록은 정답이 아니라,

> 설계자가 자신의 선택을 설명할 수 있도록 돕는 사고 기록이다.

---

## 부록: 빠른 참조표

### A별 권장 가로선 범위 (k=1.0 기준)

| A | N (최소) | M (최대) | 비고 |
|---|----------|----------|------|
| 3 | 8 | 27 | 가장 안정적 |
| 4 | 19 | 64 | 실용적 |
| 5 | 38 | 125 | 실용적 |
| 6 | 65 | 216 | 실용적 |
| 7 | 103 | 343 | 성능 주의 |
| 8 | 154 | 512 | 성능 주의 |
| 9 | 219 | 729 | 사다리 비권장 |
| 10 | 300 | 1000 | 사다리 비권장 |

### 공정성 판단 기준

| 최대 편차 | 평가 | 권장 사항 |
|-----------|------|-----------|
| ≤ 0.01 | 매우 공정 | 실용적 사용 가능 |
| ≤ 0.02 | 충분히 공정 | 실용적 사용 가능 (기본) |
| ≤ 0.03 | 허용 가능 | 캐주얼 게임에서만 |
| > 0.03 | 편향됨 | 가로선 수 증가 필요 |

---